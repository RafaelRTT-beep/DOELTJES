#include <esp_now.h>
#include <WiFi.h>

// --- CONFIGURATIE ---
const int TARGET_ID = 2; // VERANDER DIT NAAR 2 VOOR DE TWEEDE SLAVE
const int PIEZO_PIN = 34; 
const int LED_R = 25;     
const int LED_G = 26;     
const int LED_B = 27;     

const int THRESHOLD = 1800; 

// DIT IS HET BELANGRIJKE MAC ADRES VAN JOUW MASTER
uint8_t masterAddr[] = {0x28, 0x05, 0xA5, 0x07, 0x41, 0xFC}; 

typedef struct struct_message {
    int targetID;
    int command; 
} struct_message;

struct_message myData;
struct_message incomingCmd;

bool isTargetActive = false;
int currentTargetMode = 0; 

void setLED(int r, int g, int b) {
    analogWrite(LED_R, r);
    analogWrite(LED_G, g);
    analogWrite(LED_B, b);
}

void onDataRecv(const esp_now_recv_info *info, const uint8_t *incomingData, int len) {
    memcpy(&incomingCmd, incomingData, sizeof(incomingCmd));
    
    if (incomingCmd.targetID == TARGET_ID || incomingCmd.targetID == 0) {
        currentTargetMode = incomingCmd.command;
        
        if (currentTargetMode == 1) { // SHOOT (Groen/Wit)
            setLED(0, 255, 0); 
            isTargetActive = true;
        } 
        else if (currentTargetMode == 2) { // NO-SHOOT (Rood)
            setLED(255, 0, 0);
            isTargetActive = true;
        } 
        else { // UIT
            setLED(0, 0, 0);
            isTargetActive = false;
        }
    }
}
